<!DOCTYPE html>
<meta charset="utf-8">
<title>Canvas-Sandbox</title>
<script src="lib/codemirror/codemirror.js"></script>
<script src="lib/codemirror/javascript.js"></script>
<link rel="stylesheet" href="lib/codemirror/codemirror.css">
<link rel="stylesheet" href="lib/codemirror/neat.css">
<style>
	h1 { display:none; }
	p, dl, details { display:block; font-size:1em; margin:1em; }
	dd { margin-bottom:0.5em; }
	canvas { display:block; border:1px solid black; cursor:crosshair; }
	.CodeMirror-scroll { border:1px solid black; cursor:text; }
	#main { float:left; width:600px; }
</style>
<h1>Canvas Sandbox</h1>
<div id="main">
	<canvas height="320" width="600" id="canvas"></canvas>
	<br>
	<textarea id="query" cols="60" rows="10"></textarea>
	<br>
	<input type="button" value="Ausführen" id="execute">
</div>
<div id="side">
	<dl>
		<dt>Canvas-Element:</dt>
		<dd><code>canvas</code></dd>
		<dt>2D-Context:</dt>
		<dd><code>context</code></dd>
		<dt>Winkel-Umrechner:</dt>
		<dd><code>Math.toRad(deg)</code></dd>
		<dt>Cursorposition:</dt>
		<dd><span id="posX">NA</span> / <span id="posY">NA</span></dd>
	</dl>
</div>
<script>

var $ = function(id){
	return document.getElementById(id);
}

// Globale vars
var canvas = $('canvas'),
    context = canvas.getContext('2d');
Math.toRad = function(x){
	return (x * Math.PI) / 180;
};

// Ab hier interne Funktionalität
(function(){
"use strict";

var textarea     = $('query'),
    execute      = $('execute'),
    reset        = $('reset'),
    posX         = $('posX'),
    posY         = $('posY'),
    savesettings = $('savesettings'),
    setwidth     = $('setwidth'),
    setheight    = $('setheight'),
    framework    = $('framework');

/* Create editor */
var editor = CodeMirror.fromTextArea(textarea, {
	mode: 'javascript',
	theme: 'neat',
	indentUnit: 4,
	lineNumbers: true
});

/* http://www.quirksmode.org/js/findpos.html */
var findPos = function(obj) {
	var curleft = 0,
	    curtop = 0;
	if(obj.offsetParent){
		do {
			curleft += obj.offsetLeft;
			curtop  += obj.offsetTop;
		} while (obj = obj.offsetParent);
		return [curleft,curtop];
	}
}

/* Show coordinates */
canvas.onmousemove = function(evt){
	var x = evt.clientX + document.body.scrollLeft + document.documentElement.scrollLeft - findPos(canvas)[0],
	    y = evt.clientY + document.body.scrollTop  + document.documentElement.scrollTop  - findPos(canvas)[1];
	posX.innerHTML = x;
	posY.innerHTML = y;
};
canvas.onmouseout = function(){
	posX.innerHTML = posY.innerHTML = 'NA';
}

/* Execute! */
execute.onclick = function(){
	var val = editor.getValue();
	if(val){
		try {
			eval(val);
			if(window.localStorage){
				window.localStorage.setItem('codeRecovery', val);
			}
		}
		catch(e){
			window.alert("Script-Fehler! " + e);
		}
	}
}

/* Restore last session after reload */
window.onload = function(){
	editor.focus();
	if(window.localStorage){
		var restored = window.localStorage.getItem('codeRecovery');
		if(restored && editor.getValue() == ''){
			editor.setValue(restored);
		}
	}
};

})();


</script>
